import{j as e,w as Qe,B as r,A as C,L as i,S as Re,a as j,s as We,t as Xe,u as Ee,C as Ye,n as _e,b as a,d as oe,o as de,M as l,q as Fe,T as c,v as Ze}from"./ui-vendor-CT-4tH1q.js";import{u as es,r as t}from"./react-vendor-DKKOAuGG.js";import{u as ss,S as as,N as ts}from"./useMetrics-C8Jn-Gqo.js";import{a as o}from"./index-DlMT_06m.js";import"./http-vendor-B9ygI19o.js";function ds(){const A=localStorage.getItem("access_token"),Ae=localStorage.getItem("username")||"Unknown",ce=es(),[xe,me]=t.useState(!1),[b,Me]=t.useState([]),[Pe,he]=t.useState(!0),[ue,m]=t.useState(null),[S,ze]=t.useState("all"),[h,Ie]=t.useState(null),[D,je]=t.useState(!1),[Le,ve]=t.useState(!1),[v,M]=t.useState(null),[ge,P]=t.useState("homelab"),[z,I]=t.useState(!0),[g,L]=t.useState(""),[f,T]=t.useState(""),[O,q]=t.useState("1h"),[B,U]=t.useState(""),[V,$]=t.useState(""),[H,x]=t.useState(!1),[fe,w]=t.useState(null),[Te,we]=t.useState(!1),[Oe,Ne]=t.useState(!1),[d,pe]=t.useState(null),[G,ye]=t.useState([]),[R,J]=t.useState(null),[N,K]=t.useState(""),[p,Q]=t.useState(""),[y,W]=t.useState(""),[X,Y]=t.useState(""),[Z,ee]=t.useState(!0),[ke,u]=t.useState(null),[qe,k]=t.useState(!1),[Be,E]=t.useState(!1),[se,ae]=t.useState(null),[te,Ce]=t.useState(null),{connectionStatus:Ue}=ss(A);t.useEffect(()=>{if(!A){ce("/login");return}re(),be()},[A,S]);const be=async()=>{try{const s=await o.getDhcpServiceStatus();Ie(s)}catch(s){console.error("Failed to fetch DHCP service status:",s)}},_=async s=>{je(!0);try{await o.controlDhcpService(s),setTimeout(()=>{be()},1e3)}catch(n){m(n?.response?.data?.detail||n.message||`Failed to ${s} DHCP service`)}finally{je(!1)}},re=async()=>{he(!0),m(null);try{const s=S==="all"?void 0:S,n=await o.getDhcpNetworks(s);Me(n)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to load DHCP networks")}finally{he(!1)}},F=async s=>{try{const n=await o.getDhcpReservations(s);ye(n)}catch(n){m(n?.response?.data?.detail||n.message||"Failed to load DHCP reservations")}},Ve=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),ce("/login")},le=s=>{s?(M(s),P(s.network),I(s.enabled),L(s.start),T(s.end),q(s.lease_time),U(s.dns_servers?.join(", ")||""),$(s.dynamic_domain||"")):(M(null),P("homelab"),I(!0),L(""),T(""),q("1h"),U(""),$("")),w(null),ve(!0)},ne=()=>{ve(!1),M(null),w(null)},$e=async()=>{w(null),x(!0);try{if(!g.trim()||!f.trim()){w("Start and end IP addresses are required"),x(!1);return}const s=B.trim()?B.split(",").map(n=>n.trim()).filter(n=>n):null;if(v){const n={enabled:z,start:g.trim(),end:f.trim(),lease_time:O.trim(),dns_servers:s,dynamic_domain:V.trim()||null};await o.updateDhcpNetwork(v.id,n)}else{const n={network:ge,enabled:z,start:g.trim(),end:f.trim(),lease_time:O.trim(),dns_servers:s,dynamic_domain:V.trim()||null};await o.createDhcpNetwork(n)}await re(),ne()}catch(s){w(s?.response?.data?.detail||s.message||"Failed to save network")}finally{x(!1)}},Ge=async()=>{if(se)try{await o.deleteDhcpNetwork(se.id),await re(),k(!1),ae(null)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to delete network")}},Se=async s=>{pe(s),await F(s.id),we(!0)},De=()=>{we(!1),pe(null),ye([])},He=s=>{s?(J(s),K(s.hostname),Q(s.hw_address),W(s.ip_address),Y(s.comment||""),ee(s.enabled)):(J(null),K(""),Q(""),W(""),Y(""),ee(!0)),u(null),Ne(!0)},ie=()=>{Ne(!1),J(null),u(null),d&&F(d.id)},Je=async()=>{if(d){u(null),x(!0);try{if(!N.trim()){u("Hostname is required"),x(!1);return}if(!p.trim()){u("MAC address is required"),x(!1);return}if(!y.trim()){u("IP address is required"),x(!1);return}if(R){const s={hostname:N.trim(),hw_address:p.trim(),ip_address:y.trim(),comment:X.trim()||null,enabled:Z};await o.updateDhcpReservation(R.id,s)}else{const s={network_id:d.id,hostname:N.trim(),hw_address:p.trim(),ip_address:y.trim(),comment:X.trim()||null,enabled:Z};await o.createDhcpReservation(d.id,s)}await F(d.id),ie()}catch(s){u(s?.response?.data?.detail||s.message||"Failed to save reservation")}finally{x(!1)}}},Ke=async()=>{if(te)try{await o.deleteDhcpReservation(te.id),d&&await F(d.id),E(!1),Ce(null)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to delete reservation")}};return Pe?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading DHCP networks..."})]})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(as,{onLogout:Ve,isOpen:xe,onClose:()=>me(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ts,{hostname:"nixos-router",username:Ae,connectionStatus:Ue,onMenuClick:()=>me(!xe)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qe,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DHCP Management"})]}),e.jsx(r,{color:"blue",onClick:()=>le(),children:"New Network"})]}),ue&&e.jsx(C,{color:"failure",className:"mb-6",onDismiss:()=>m(null),children:ue}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row justify-between items-start md:items-end gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkFilter",value:"Filter by Network"}),e.jsxs(Re,{id:"networkFilter",value:S,onChange:s=>ze(s.target.value),className:"mt-1 w-48",children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i,{value:"DHCP Service"}),e.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[h&&e.jsx(j,{color:h.is_active?"success":"gray",size:"sm",children:h.is_active?"Running":h.is_enabled?"Stopped":"Disabled"}),e.jsx(r,{size:"xs",color:"success",onClick:()=>_("start"),disabled:D||(h?.is_active??!1),title:"Start Service",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>_("stop"),disabled:D||!(h?.is_active??!1),title:"Stop Service",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"warning",onClick:()=>_("reload"),disabled:D||!(h?.is_active??!1),title:"Reload Service",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"purple",onClick:()=>_("restart"),disabled:D,title:"Restart Service",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]})]}),e.jsxs(Ye,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["DHCP Networks (",b.length,")"]}),b.length===0?e.jsx(C,{color:"info",icon:_e,children:"No DHCP networks configured. Create a network to get started."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Network"}),e.jsx(a.HeadCell,{children:"IP Range"}),e.jsx(a.HeadCell,{children:"Lease Time"}),e.jsx(a.HeadCell,{children:"DNS Servers"}),e.jsx(a.HeadCell,{children:"Dynamic Domain"}),e.jsx(a.HeadCell,{children:"Status"}),e.jsx(a.HeadCell,{children:"Actions"})]}),e.jsx(a.Body,{className:"divide-y",children:b.map(s=>e.jsxs(a.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(a.Cell,{children:e.jsx(j,{color:"blue",children:s.network})}),e.jsxs(a.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:[s.start," - ",s.end]}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.lease_time}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.dns_servers?.join(", ")||"-"}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.dynamic_domain||"-"}),e.jsx(a.Cell,{children:e.jsx(j,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(a.Cell,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>Se(s),children:"Reservations"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>le(s),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{ae(s),k(!0)},children:e.jsx(de,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:b.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(j,{color:"blue",size:"sm",className:"mb-2",children:s.network}),e.jsxs("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:[s.start," - ",s.end]})]}),e.jsx(j,{color:s.enabled?"success":"gray",size:"sm",children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"space-y-2 text-sm mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Lease Time:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.lease_time})]}),s.dns_servers&&s.dns_servers.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"DNS Servers:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-mono text-xs",children:s.dns_servers.join(", ")})]}),s.dynamic_domain&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Dynamic Domain:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:s.dynamic_domain})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>Se(s),className:"flex-1 min-w-[100px]",children:"Reservations"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>le(s),className:"flex-1 min-w-[80px]",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{ae(s),k(!0)},className:"flex-1 min-w-[80px]",children:e.jsx(de,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsxs(l,{show:Le,onClose:ne,size:"lg",children:[e.jsx(l.Header,{children:v?"Edit DHCP Network":"Create DHCP Network"}),e.jsx(l.Body,{children:e.jsxs("div",{className:"space-y-4",children:[fe&&e.jsx(C,{color:"failure",children:fe}),!v&&e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkNetwork",value:"Network *"}),e.jsxs(Re,{id:"networkNetwork",value:ge,onChange:s=>P(s.target.value),className:"mt-1",required:!0,children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{id:"networkEnabled",checked:z,onChange:s=>I(s.target.checked)}),e.jsx(i,{htmlFor:"networkEnabled",value:"Enabled"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkStart",value:"IP Range Start *"}),e.jsx(c,{id:"networkStart",value:g,onChange:s=>L(s.target.value),placeholder:"192.168.2.100",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkEnd",value:"IP Range End *"}),e.jsx(c,{id:"networkEnd",value:f,onChange:s=>T(s.target.value),placeholder:"192.168.2.200",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkLeaseTime",value:"Lease Time *"}),e.jsx(c,{id:"networkLeaseTime",value:O,onChange:s=>q(s.target.value),placeholder:"1h, 1d, or 86400",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkDnsServers",value:"DNS Servers (comma-separated)"}),e.jsx(c,{id:"networkDnsServers",value:B,onChange:s=>U(s.target.value),placeholder:"192.168.2.1, 8.8.8.8",className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"networkDynamicDomain",value:"Dynamic DNS Domain (optional)"}),e.jsx(c,{id:"networkDynamicDomain",value:V,onChange:s=>$(s.target.value),placeholder:"dhcp.homelab.local",className:"mt-1"})]})]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"blue",onClick:$e,disabled:H||!g.trim()||!f.trim(),children:H?"Saving...":v?"Update":"Create"}),e.jsx(r,{color:"gray",onClick:ne,children:"Cancel"})]})]}),e.jsxs(l,{show:Te,onClose:De,size:"6xl",children:[e.jsxs(l.Header,{children:["Reservations - ",d?.network.toUpperCase()]}),e.jsxs(l.Body,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Static IP Reservations (",G.length,")"]}),e.jsxs(r,{size:"sm",color:"blue",onClick:()=>He(),children:[e.jsx(Ze,{className:"w-4 h-4 mr-1"}),"New Reservation"]})]}),G.length===0?e.jsx(C,{color:"info",icon:_e,children:"No reservations configured for this network."}):e.jsxs(a,{children:[e.jsxs(a.Head,{children:[e.jsx(a.HeadCell,{children:"Hostname"}),e.jsx(a.HeadCell,{children:"MAC Address"}),e.jsx(a.HeadCell,{children:"IP Address"}),e.jsx(a.HeadCell,{children:"Comment"}),e.jsx(a.HeadCell,{children:"Status"}),e.jsx(a.HeadCell,{children:"Actions"})]}),e.jsx(a.Body,{className:"divide-y",children:G.map(s=>e.jsxs(a.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(a.Cell,{className:"font-medium text-gray-900 dark:text-white",children:s.hostname}),e.jsx(a.Cell,{className:"font-mono text-sm text-gray-500 dark:text-gray-400",children:s.hw_address}),e.jsx(a.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.ip_address}),e.jsx(a.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.comment||"-"}),e.jsx(a.Cell,{children:e.jsx(j,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(a.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"xs",color:"gray",onClick:()=>He(s),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{Ce(s),E(!0)},children:e.jsx(de,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsx(l.Footer,{children:e.jsx(r,{color:"gray",onClick:De,children:"Close"})})]}),e.jsxs(l,{show:Oe,onClose:ie,size:"lg",children:[e.jsx(l.Header,{children:R?"Edit Reservation":"Create Reservation"}),e.jsx(l.Body,{children:e.jsxs("div",{className:"space-y-4",children:[ke&&e.jsx(C,{color:"failure",children:ke}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationHostname",value:"Hostname *"}),e.jsx(c,{id:"reservationHostname",value:N,onChange:s=>K(s.target.value),placeholder:"desktop",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationHwAddress",value:"MAC Address *"}),e.jsx(c,{id:"reservationHwAddress",value:p,onChange:s=>Q(s.target.value),placeholder:"11:22:33:44:55:66",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationIpAddress",value:"IP Address *"}),e.jsx(c,{id:"reservationIpAddress",value:y,onChange:s=>W(s.target.value),placeholder:"192.168.2.50",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"reservationComment",value:"Comment (optional)"}),e.jsx(c,{id:"reservationComment",value:X,onChange:s=>Y(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{id:"reservationEnabled",checked:Z,onChange:s=>ee(s.target.checked)}),e.jsx(i,{htmlFor:"reservationEnabled",value:"Enabled"})]})]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"blue",onClick:Je,disabled:H||!N.trim()||!p.trim()||!y.trim(),children:H?"Saving...":R?"Update":"Create"}),e.jsx(r,{color:"gray",onClick:ie,children:"Cancel"})]})]}),e.jsxs(l,{show:qe,onClose:()=>k(!1),size:"md",children:[e.jsx(l.Header,{children:"Delete DHCP Network"}),e.jsx(l.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete the DHCP network for ",e.jsx("strong",{children:se?.network}),"? This will also delete all reservations for this network."]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"failure",onClick:Ge,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>k(!1),children:"Cancel"})]})]}),e.jsxs(l,{show:Be,onClose:()=>E(!1),size:"md",children:[e.jsx(l.Header,{children:"Delete Reservation"}),e.jsx(l.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete the reservation for ",e.jsx("strong",{children:te?.hostname}),"?"]})}),e.jsxs(l.Footer,{children:[e.jsx(r,{color:"failure",onClick:Ke,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>E(!1),children:"Cancel"})]})]})]})})]})]})}export{ds as Dhcp};
