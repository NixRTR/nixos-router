import{j as e,s as _e,B as r,A as m,L as c,S as te,C as Le,l as Ve,b as l,a as p,t as pe,d as ye,o as we,M as t,T as u}from"./ui-vendor-CSSb4Uq7.js";import{u as Ie,r as a}from"./react-vendor-DKKOAuGG.js";import{u as qe,S as Pe,N as Ge}from"./useMetrics-B3VA77oz.js";import{a as d}from"./index-D5iyb6IP.js";import"./http-vendor-B9ygI19o.js";function Qe(){const D=localStorage.getItem("access_token"),Ce=localStorage.getItem("username")||"Unknown",re=Ie(),[oe,ne]=a.useState(!1),[R,be]=a.useState([]),[ke,ce]=a.useState(!0),[de,h]=a.useState(null),[y,Se]=a.useState("all"),[De,ie]=a.useState(!1),[F,E]=a.useState(null),[j,Z]=a.useState(""),[A,H]=a.useState("homelab"),[T,z]=a.useState(!0),[M,O]=a.useState(""),[B,_]=a.useState(""),[L,V]=a.useState(!0),[w,i]=a.useState(!1),[he,g]=a.useState(null),[Re,xe]=a.useState(!1),[Fe,me]=a.useState(!1),[n,I]=a.useState(null),[ue,je]=a.useState([]),[q,P]=a.useState(null),[v,G]=a.useState(""),[N,U]=a.useState("A"),[f,Y]=a.useState(""),[$,J]=a.useState(""),[K,Q]=a.useState(!0),[C,x]=a.useState(null),[Ee,b]=a.useState(!1),[Ze,k]=a.useState(!1),[W,ge]=a.useState(null),[X,ve]=a.useState(null),{connectionStatus:Ae}=qe(D);a.useEffect(()=>{if(!D){re("/login");return}ee()},[D,y]);const ee=async()=>{ce(!0),h(null);try{const s=y==="all"?void 0:y,o=await d.getDnsZones(s);be(o)}catch(s){h(s?.response?.data?.detail||s.message||"Failed to load DNS zones")}finally{ce(!1)}},S=async s=>{try{const o=await d.getDnsRecords(s);je(o)}catch(o){h(o?.response?.data?.detail||o.message||"Failed to load DNS records")}},He=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),re("/login")},Ne=s=>{s?(E(s),Z(s.name),H(s.network),z(s.authoritative),O(s.forward_to||""),_(s.delegate_to||""),V(s.enabled)):(E(null),Z(""),H("homelab"),z(!0),O(""),_(""),V(!0)),g(null),ie(!0)},se=()=>{ie(!1),E(null),g(null)},Te=async()=>{g(null),i(!0);try{if(!j.trim()){g("Zone name is required"),i(!1);return}if(F){const s={name:j.trim(),network:A,authoritative:T,forward_to:M.trim()||null,delegate_to:B.trim()||null,enabled:L};await d.updateDnsZone(F.id,s)}else{const s={name:j.trim(),network:A,authoritative:T,forward_to:M.trim()||null,delegate_to:B.trim()||null,enabled:L};await d.createDnsZone(s)}await ee(),se()}catch(s){g(s?.response?.data?.detail||s.message||"Failed to save zone")}finally{i(!1)}},ze=async()=>{if(W)try{await d.deleteDnsZone(W.id),await ee(),b(!1),ge(null)}catch(s){h(s?.response?.data?.detail||s.message||"Failed to delete zone")}},Me=async s=>{I(s),await S(s.id),xe(!0)},fe=(s,o)=>{I(s),o?(P(o),G(o.name),U(o.type),Y(o.value),J(o.comment||""),Q(o.enabled)):(P(null),G(""),U("A"),Y(""),J(""),Q(!0)),x(null),me(!0)},le=()=>{xe(!1),I(null),je([])},ae=()=>{me(!1),P(null),x(null),n&&S(n.id)},Oe=async()=>{if(n){x(null),i(!0);try{if(!v.trim()){x("Record name is required"),i(!1);return}if(!f.trim()){x("Record value is required"),i(!1);return}if(q){const s={name:v.trim(),type:N,value:f.trim(),comment:$.trim()||null,enabled:K};await d.updateDnsRecord(q.id,s)}else{const s={zone_id:n.id,name:v.trim(),type:N,value:f.trim(),comment:$.trim()||null,enabled:K};await d.createDnsRecord(n.id,s)}await S(n.id),ae()}catch(s){x(s?.response?.data?.detail||s.message||"Failed to save record")}finally{i(!1)}}},Be=async()=>{if(X)try{await d.deleteDnsRecord(X.id),n&&await S(n.id),k(!1),ve(null)}catch(s){h(s?.response?.data?.detail||s.message||"Failed to delete record")}};return ke?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading DNS zones..."})]})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Pe,{onLogout:He,isOpen:oe,onClose:()=>ne(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Ge,{hostname:"nixos-router",username:Ce,connectionStatus:Ae,onMenuClick:()=>ne(!oe)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DNS Management"})]}),e.jsx(r,{color:"blue",onClick:()=>Ne(),children:"New Zone"})]}),de&&e.jsx(m,{color:"failure",className:"mb-6",onDismiss:()=>h(null),children:de}),e.jsxs("div",{className:"mb-4",children:[e.jsx(c,{htmlFor:"networkFilter",value:"Filter by Network"}),e.jsxs(te,{id:"networkFilter",value:y,onChange:s=>Se(s.target.value),className:"mt-1 w-48",children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs(Le,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["DNS Zones (",R.length,")"]}),R.length===0?e.jsx(m,{color:"info",icon:Ve,children:"No DNS zones configured. Create a zone to get started."}):e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Name"}),e.jsx(l.HeadCell,{children:"Network"}),e.jsx(l.HeadCell,{children:"Authoritative"}),e.jsx(l.HeadCell,{children:"Forward To"}),e.jsx(l.HeadCell,{children:"Delegate To"}),e.jsx(l.HeadCell,{children:"Status"}),e.jsx(l.HeadCell,{children:"Actions"})]}),e.jsx(l.Body,{className:"divide-y",children:R.map(s=>e.jsxs(l.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(l.Cell,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx(l.Cell,{children:e.jsx(p,{color:"blue",children:s.network})}),e.jsx(l.Cell,{children:e.jsx(p,{color:s.authoritative?"success":"gray",children:s.authoritative?"Yes":"No"})}),e.jsx(l.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.forward_to||"-"}),e.jsx(l.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.delegate_to||"-"}),e.jsx(l.Cell,{children:e.jsx(p,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(l.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"xs",color:"blue",onClick:()=>Me(s),children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Records"]}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>Ne(s),children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{ge(s),b(!0)},children:e.jsx(we,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsxs(t,{show:De,onClose:se,size:"lg",children:[e.jsx(t.Header,{children:F?"Edit DNS Zone":"Create DNS Zone"}),e.jsx(t.Body,{children:e.jsxs("div",{className:"space-y-4",children:[he&&e.jsx(m,{color:"failure",children:he}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneName",value:"Zone Name *"}),e.jsx(u,{id:"zoneName",value:j,onChange:s=>Z(s.target.value),placeholder:"example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneNetwork",value:"Network *"}),e.jsxs(te,{id:"zoneNetwork",value:A,onChange:s=>H(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"zoneAuthoritative",checked:T,onChange:s=>z(s.target.checked),className:"w-4 h-4"}),e.jsx(c,{htmlFor:"zoneAuthoritative",value:"Authoritative (serve locally)"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneForwardTo",value:"Forward To (optional)"}),e.jsx(u,{id:"zoneForwardTo",value:M,onChange:s=>O(s.target.value),placeholder:"192.168.1.1",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneDelegateTo",value:"Delegate To (optional)"}),e.jsx(u,{id:"zoneDelegateTo",value:B,onChange:s=>_(s.target.value),placeholder:"ns1.example.com",className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"zoneEnabled",checked:L,onChange:s=>V(s.target.checked),className:"w-4 h-4"}),e.jsx(c,{htmlFor:"zoneEnabled",value:"Enabled"})]})]})}),e.jsxs(t.Footer,{children:[e.jsx(r,{color:"blue",onClick:Te,disabled:w||!j.trim(),children:w?"Saving...":"Save"}),e.jsx(r,{color:"gray",onClick:se,children:"Cancel"})]})]}),e.jsxs(t,{show:Re,onClose:le,size:"4xl",children:[e.jsx(t.Header,{children:n?`DNS Records for ${n.name}`:"DNS Records"}),e.jsx(t.Body,{children:e.jsxs("div",{className:"space-y-4",children:[C&&e.jsx(m,{color:"failure",children:C}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Records"}),n&&e.jsxs(r,{size:"sm",color:"blue",onClick:()=>fe(n),children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Add Record"]})]}),ue.length===0?e.jsx(m,{color:"info",children:"No records in this zone. Add a record to get started."}):e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Name"}),e.jsx(l.HeadCell,{children:"Type"}),e.jsx(l.HeadCell,{children:"Value"}),e.jsx(l.HeadCell,{children:"Comment"}),e.jsx(l.HeadCell,{children:"Status"}),e.jsx(l.HeadCell,{children:"Actions"})]}),e.jsx(l.Body,{className:"divide-y",children:ue.map(s=>e.jsxs(l.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(l.Cell,{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx(l.Cell,{children:e.jsx(p,{color:s.type==="A"?"blue":"purple",children:s.type})}),e.jsx(l.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.value}),e.jsx(l.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.comment||"-"}),e.jsx(l.Cell,{children:e.jsx(p,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(l.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"xs",color:"gray",onClick:()=>{le(),fe(n,s)},children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{ve(s),k(!0)},children:e.jsx(we,{className:"w-4 h-4"})})]})})]},s.id))})]})]})}),e.jsx(t.Footer,{children:e.jsx(r,{color:"gray",onClick:le,children:"Close"})})]}),e.jsxs(t,{show:Fe,onClose:ae,size:"lg",children:[e.jsx(t.Header,{children:q?"Edit DNS Record":"Create DNS Record"}),e.jsx(t.Body,{children:e.jsxs("div",{className:"space-y-4",children:[C&&e.jsx(m,{color:"failure",children:C}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordName",value:"Record Name *"}),e.jsx(u,{id:"recordName",value:v,onChange:s=>G(s.target.value),placeholder:"hostname.example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordType",value:"Record Type *"}),e.jsxs(te,{id:"recordType",value:N,onChange:s=>U(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"A",children:"A (IPv4 Address)"}),e.jsx("option",{value:"CNAME",children:"CNAME (Alias)"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordValue",value:N==="A"?"IP Address *":"Target Hostname *"}),e.jsx(u,{id:"recordValue",value:f,onChange:s=>Y(s.target.value),placeholder:N==="A"?"192.168.1.1":"target.example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordComment",value:"Comment (optional)"}),e.jsx(u,{id:"recordComment",value:$,onChange:s=>J(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recordEnabled",checked:K,onChange:s=>Q(s.target.checked),className:"w-4 h-4"}),e.jsx(c,{htmlFor:"recordEnabled",value:"Enabled"})]})]})}),e.jsxs(t.Footer,{children:[e.jsx(r,{color:"blue",onClick:Oe,disabled:w||!v.trim()||!f.trim(),children:w?"Saving...":"Save"}),e.jsx(r,{color:"gray",onClick:ae,children:"Cancel"})]})]}),e.jsxs(t,{show:Ee,onClose:()=>b(!1),size:"md",children:[e.jsx(t.Header,{children:"Delete Zone"}),e.jsx(t.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete zone ",e.jsx("strong",{children:W?.name}),"? This will also delete all records in this zone."]})}),e.jsxs(t.Footer,{children:[e.jsx(r,{color:"failure",onClick:ze,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>b(!1),children:"Cancel"})]})]}),e.jsxs(t,{show:Ze,onClose:()=>k(!1),size:"md",children:[e.jsx(t.Header,{children:"Delete Record"}),e.jsx(t.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete record ",e.jsx("strong",{children:X?.name}),"?"]})}),e.jsxs(t.Footer,{children:[e.jsx(r,{color:"failure",onClick:Be,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>k(!1),children:"Cancel"})]})]})]})})]})]})}export{Qe as Dns};
