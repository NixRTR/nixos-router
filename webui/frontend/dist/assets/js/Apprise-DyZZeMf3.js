import{j as e,A as r,h as J,i as ue,k as g,l as ge,C as y,L as N,T as me,m as xe,S as he,B as b,a as pe}from"./ui-vendor-CgIz45wR.js";import{u as fe,r as i}from"./react-vendor-DKKOAuGG.js";import{u as je,S as R,N as L}from"./useMetrics-CUgUjZu-.js";import{a as o}from"./index-DNUFL8VM.js";import"./http-vendor-B9ygI19o.js";function ve(){const K=localStorage.getItem("access_token"),w=localStorage.getItem("username")||"Unknown",Q=fe(),[c,d]=i.useState(!1),[V,F]=i.useState(!1),[S,B]=i.useState([]),[Z,H]=i.useState(!0),[O,U]=i.useState(null),[l,$]=i.useState(""),[v,z]=i.useState(""),[k,W]=i.useState("info"),[_,q]=i.useState(!1),[m,u]=i.useState(null),[I,P]=i.useState(new Set),[ee,M]=i.useState(new Map),[se,T]=i.useState(new Map),[te,X]=i.useState(new Set),[ae,C]=i.useState(new Map),[ie,x]=i.useState(new Map),{connectionStatus:A}=je(K);i.useEffect(()=>{ne()},[]);const ne=async()=>{H(!0),U(null);try{const[t,s]=await Promise.all([o.getAppriseStatus(),o.getAppriseConfig()]);if(F(t.enabled),s.enabled&&s.services)B(s.services.map(a=>({url:a})));else{const a=await o.getAppriseServices();B(a)}}catch(t){U(t.response?.data?.detail||t.message||"Failed to fetch Apprise status"),F(!1)}finally{H(!1)}},re=async()=>{if(!l.trim()){u({success:!1,message:"Message body is required"});return}q(!0),u(null);try{const t=await o.sendAppriseNotification(l,v||void 0,k||void 0);u(t),t.success&&($(""),z(""),W("info"))}catch(t){u({success:!1,message:t.response?.data?.detail||t.message||"Failed to send notification"})}finally{q(!1)}},le=async t=>{if(!l.trim()){x(s=>new Map(s).set(t,"Message body is required"));return}X(s=>new Set(s).add(t)),x(s=>{const a=new Map(s);return a.delete(t),a}),C(s=>{const a=new Map(s);return a.delete(t),a});try{const s=await o.sendAppriseNotificationToService(t,l,v||void 0,k||void 0);if(C(a=>new Map(a).set(t,s)),!s.success){const a=s.details?`${s.message}: ${s.details}`:s.message;x(n=>new Map(n).set(t,a))}}catch(s){const a=s.response?.data?.detail||s.message||"Failed to send notification";x(n=>new Map(n).set(t,a)),C(n=>new Map(n).set(t,{success:!1,message:a}))}finally{X(s=>{const a=new Set(s);return a.delete(t),a})}},oe=async t=>{P(s=>new Set(s).add(t)),T(s=>{const a=new Map(s);return a.delete(t),a}),M(s=>{const a=new Map(s);return a.delete(t),a});try{const s=await o.testAppriseService(t);if(M(a=>new Map(a).set(t,s)),!s.success){const a=s.details?`${s.message}: ${s.details}`:s.message;T(n=>new Map(n).set(t,a))}}catch(s){const a=s.response?.data?.detail||s.message||"Failed to send test notification";T(n=>new Map(n).set(t,a)),M(n=>new Map(n).set(t,{success:!1,message:a}))}finally{P(s=>{const a=new Set(s);return a.delete(t),a})}},D=()=>{const t=window.location.origin,s=localStorage.getItem("access_token");return`curl -X POST ${t}/api/apprise/notify \\
  -H "Authorization: Bearer ${s}" \\
  -H "Content-Type: application/json" \\
  -d '{
    "body": "Your notification message here",
    "title": "Notification Title (optional)",
    "notification_type": "info"
  }'`},ce=t=>{const s=t.match(/^([^:]+):/);return s?s[1].charAt(0).toUpperCase()+s[1].slice(1):"Unknown Service"},E=async()=>{await o.logout(),Q("/login")};return Z?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(R,{onLogout:E,isOpen:c,onClose:()=>d(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:w,connectionStatus:A,onMenuClick:()=>d(!c)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"text-center py-16 text-gray-500",children:"Loading Apprise configuration..."})})]})]}):V?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(R,{onLogout:E,isOpen:c,onClose:()=>d(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:w,connectionStatus:A,onMenuClick:()=>d(!c)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ue,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Apprise Notifications"})]}),O&&e.jsx(r,{color:"failure",className:"mb-6",children:O}),m&&e.jsx(r,{color:m.success?"success":"failure",icon:m.success?g:ge,className:"mb-6",onDismiss:()=>u(null),children:m.message}),e.jsxs(y,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"How It Works"}),e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:["Apprise is integrated into the NixOS Router WebUI backend, allowing you to send notifications to multiple services configured in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}),e.jsx("p",{children:"Notifications can be sent to all configured services simultaneously, or you can test individual services to verify they're working correctly."}),e.jsx("p",{children:e.jsx("strong",{children:"Notification Types:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"info"})," - General information (default)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"success"})," - Success messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"warning"})," - Warning messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"failure"})," - Error/failure messages"]})]})]})]}),e.jsxs(y,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Send Notification"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"title",value:"Title (optional)"}),e.jsx(me,{id:"title",type:"text",placeholder:"Notification title",value:v,onChange:t=>z(t.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"body",value:"Message Body *"}),e.jsx(xe,{id:"body",placeholder:"Enter your notification message...",value:l,onChange:t=>$(t.target.value),rows:4,className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"type",value:"Notification Type"}),e.jsxs(he,{id:"type",value:k,onChange:t=>W(t.target.value),className:"mt-1",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"failure",children:"Failure"})]})]}),e.jsx(b,{onClick:re,disabled:_||!l.trim(),className:"w-full sm:w-auto",children:_?"Sending...":"Send to All Services"})]})]}),e.jsxs(y,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Configured Services (",S.length,")"]}),S.length===0?e.jsxs(r,{color:"info",icon:J,children:["No notification services are configured. Add services in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}):e.jsx("div",{className:"space-y-4",children:S.map((t,s)=>{const a=I.has(s),n=ee.get(s),G=se.get(s),h=n?.success===!0,p=te.has(s),f=ae.get(s),Y=ie.get(s),j=f?.success===!0;return e.jsxs(y,{className:"bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{color:"info",children:ce(t.url)}),h&&e.jsx(g,{className:"w-5 h-5 text-green-500",title:"Test successful"}),j&&e.jsx(g,{className:"w-5 h-5 text-blue-500",title:"Notification sent"})]}),e.jsx("code",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:t.url}),G&&e.jsx(r,{color:"failure",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Test Error:"})," ",G]})}),n?.success&&n.details&&e.jsx(r,{color:"success",className:"mt-2",children:e.jsx("div",{className:"text-sm",children:n.details})}),Y&&e.jsx(r,{color:"failure",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Send Error:"})," ",Y]})}),f?.success&&f.details&&e.jsx(r,{color:"success",className:"mt-2",children:e.jsx("div",{className:"text-sm",children:f.details})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(b,{size:"sm",color:h?"success":"light",onClick:()=>oe(s),disabled:a||p,children:a?"Testing...":h?"Test Again":"Test"}),h&&!a&&e.jsx(g,{className:"absolute -top-1 -right-1 w-5 h-5 text-green-500 bg-white dark:bg-gray-800 rounded-full"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{size:"sm",color:j?"success":"blue",onClick:()=>le(s),disabled:p||a||!l.trim(),children:p?"Sending...":j?"Send Again":"Send"}),j&&!p&&e.jsx(g,{className:"absolute -top-1 -right-1 w-5 h-5 text-blue-500 bg-white dark:bg-gray-800 rounded-full"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(N,{value:"Example cURL Command",className:"mb-2 block"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto pr-20",children:e.jsx("code",{children:D()})}),e.jsx(b,{size:"xs",color:"light",className:"absolute top-2 right-2",onClick:async()=>{try{await navigator.clipboard.writeText(D())}catch(de){console.error("Failed to copy:",de)}},children:"Copy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Replace the message body, title, and notification_type as needed."})]})]},s)})})]})]})})]})]}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(R,{onLogout:E,isOpen:c,onClose:()=>d(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{hostname:"nixos-router",username:w,connectionStatus:A,onMenuClick:()=>d(!c)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs(r,{color:"warning",icon:J,children:[e.jsx("span",{className:"font-medium",children:"Apprise is not enabled."}),e.jsxs("div",{className:"mt-2 text-sm",children:["To enable Apprise notifications, set ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"apprise.enable = true"})," in your ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"})," file."]})]})})]})]})}export{ve as Apprise};
