import{j as e,r as Ue,B as r,A as g,L as c,S as xe,C as Je,n as Qe,b as l,a as h,d as he,s as _e,t as Ae,u as _,o as me,M as o,T as v,v as Xe}from"./ui-vendor-CT-4tH1q.js";import{u as es,r as t}from"./react-vendor-DKKOAuGG.js";import{u as ss,S as as,N as ls}from"./useMetrics-C8Jn-Gqo.js";import{a as d}from"./index-DlMT_06m.js";import"./http-vendor-B9ygI19o.js";function cs(){const A=localStorage.getItem("access_token"),Ee=localStorage.getItem("username")||"Unknown",ue=es(),[je,ge]=t.useState(!1),[k,He]=t.useState([]),[Te,ve]=t.useState(!0),[Ne,m]=t.useState(null),[C,Me]=t.useState("all"),[ze,Oe]=t.useState({}),[pe,fe]=t.useState(null),[Be,we]=t.useState(!1),[E,H]=t.useState(null),[N,T]=t.useState(""),[M,z]=t.useState("homelab"),[O,B]=t.useState(!0),[L,V]=t.useState(""),[I,q]=t.useState(""),[P,$]=t.useState(!0),[D,u]=t.useState(!1),[ye,p]=t.useState(null),[Le,be]=t.useState(!1),[Ve,Se]=t.useState(!1),[n,K]=t.useState(null),[ke,Ce]=t.useState([]),[W,Y]=t.useState(null),[f,G]=t.useState(""),[w,U]=t.useState("A"),[y,J]=t.useState(""),[Q,X]=t.useState(""),[ee,se]=t.useState(!0),[R,j]=t.useState(null),[Ie,b]=t.useState(!1),[qe,F]=t.useState(!1),[ae,le]=t.useState(null),[te,De]=t.useState(null),{connectionStatus:Pe}=ss(A);t.useEffect(()=>{if(!A){ue("/login");return}re(),Re()},[A,C]);const re=async()=>{ve(!0),m(null);try{const s=C==="all"?void 0:C,a=await d.getDnsZones(s);He(a)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to load DNS zones")}finally{ve(!1)}},Re=async()=>{try{const[s,a]=await Promise.all([d.getDnsServiceStatus("homelab"),d.getDnsServiceStatus("lan")]);Oe({homelab:s,lan:a})}catch(s){console.error("Failed to fetch DNS service statuses:",s)}},x=async(s,a)=>{const S=`${s}-${a}`;fe(S);try{await d.controlDnsService(s,a),setTimeout(()=>{Re()},1e3)}catch(i){m(i?.response?.data?.detail||i.message||`Failed to ${a} DNS service`)}finally{fe(null)}},oe=s=>{const a=ze[s.network];return!a||!a.exists?{is_active:!1,is_enabled:!1}:{is_active:a.is_active,is_enabled:a.is_enabled}},Z=async s=>{try{const a=await d.getDnsRecords(s);Ce(a)}catch(a){m(a?.response?.data?.detail||a.message||"Failed to load DNS records")}},$e=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),ue("/login")},ne=s=>{s?(H(s),T(s.name),z(s.network),B(s.authoritative),V(s.forward_to||""),q(s.delegate_to||""),$(s.enabled)):(H(null),T(""),z("homelab"),B(!0),V(""),q(""),$(!0)),p(null),we(!0)},ie=()=>{we(!1),H(null),p(null)},Ke=async()=>{p(null),u(!0);try{if(!N.trim()){p("Zone name is required"),u(!1);return}if(E){const s={name:N.trim(),network:M,authoritative:O,forward_to:L.trim()||null,delegate_to:I.trim()||null,enabled:P};await d.updateDnsZone(E.id,s)}else{const s={name:N.trim(),network:M,authoritative:O,forward_to:L.trim()||null,delegate_to:I.trim()||null,enabled:P};await d.createDnsZone(s)}await re(),ie()}catch(s){p(s?.response?.data?.detail||s.message||"Failed to save zone")}finally{u(!1)}},We=async()=>{if(ae)try{await d.deleteDnsZone(ae.id),await re(),b(!1),le(null)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to delete zone")}},Fe=async s=>{K(s),await Z(s.id),be(!0)},Ze=(s,a)=>{K(s),a?(Y(a),G(a.name),U(a.type),J(a.value),X(a.comment||""),se(a.enabled)):(Y(null),G(""),U("A"),J(""),X(""),se(!0)),j(null),Se(!0)},ce=()=>{be(!1),K(null),Ce([])},de=()=>{Se(!1),Y(null),j(null),n&&Z(n.id)},Ye=async()=>{if(n){j(null),u(!0);try{if(!f.trim()){j("Record name is required"),u(!1);return}if(!y.trim()){j("Record value is required"),u(!1);return}if(W){const s={name:f.trim(),type:w,value:y.trim(),comment:Q.trim()||null,enabled:ee};await d.updateDnsRecord(W.id,s)}else{const s={zone_id:n.id,name:f.trim(),type:w,value:y.trim(),comment:Q.trim()||null,enabled:ee};await d.createDnsRecord(n.id,s)}await Z(n.id),de()}catch(s){j(s?.response?.data?.detail||s.message||"Failed to save record")}finally{u(!1)}}},Ge=async()=>{if(te)try{await d.deleteDnsRecord(te.id),n&&await Z(n.id),F(!1),De(null)}catch(s){m(s?.response?.data?.detail||s.message||"Failed to delete record")}};return Te?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading DNS zones..."})]})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(as,{onLogout:$e,isOpen:je,onClose:()=>ge(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ls,{hostname:"nixos-router",username:Ee,connectionStatus:Pe,onMenuClick:()=>ge(!je)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DNS Management"})]}),e.jsx(r,{color:"blue",onClick:()=>ne(),children:"New Zone"})]}),Ne&&e.jsx(g,{color:"failure",className:"mb-6",onDismiss:()=>m(null),children:Ne}),e.jsxs("div",{className:"mb-4",children:[e.jsx(c,{htmlFor:"networkFilter",value:"Filter by Network"}),e.jsxs(xe,{id:"networkFilter",value:C,onChange:s=>Me(s.target.value),className:"mt-1 w-48",children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs(Je,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["DNS Zones (",k.length,")"]}),k.length===0?e.jsx(g,{color:"info",icon:Qe,children:"No DNS zones configured. Create a zone to get started."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden min-[1000px]:block overflow-x-auto",children:e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Name"}),e.jsx(l.HeadCell,{children:"Network"}),e.jsx(l.HeadCell,{children:"Authoritative"}),e.jsx(l.HeadCell,{children:"Forward To"}),e.jsx(l.HeadCell,{children:"Delegate To"}),e.jsx(l.HeadCell,{children:"Status"}),e.jsx(l.HeadCell,{children:"Actions"})]}),e.jsx(l.Body,{className:"divide-y",children:k.map(s=>e.jsxs(l.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(l.Cell,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx(l.Cell,{children:e.jsx(h,{color:"blue",children:s.network})}),e.jsx(l.Cell,{children:e.jsx(h,{color:s.authoritative?"success":"gray",children:s.authoritative?"Yes":"No"})}),e.jsx(l.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.forward_to||"-"}),e.jsx(l.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.delegate_to||"-"}),e.jsx(l.Cell,{children:(()=>{const a=oe(s);return e.jsx(h,{color:a.is_active?"success":"gray",children:a.is_active?"Running":a.is_enabled?"Stopped":"Disabled"})})()}),e.jsx(l.Cell,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>Fe(s),children:"Records"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>ne(s),children:e.jsx(he,{className:"w-4 h-4"})}),(()=>{const a=oe(s),S=`${s.network}-`,i=pe?.startsWith(S);return e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"xs",color:"success",onClick:()=>x(s.network,"start"),disabled:i||a.is_active,title:"Start Service",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>x(s.network,"stop"),disabled:i||!a.is_active,title:"Stop Service",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"warning",onClick:()=>x(s.network,"reload"),disabled:i||!a.is_active,title:"Reload Service",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"purple",onClick:()=>x(s.network,"restart"),disabled:i,title:"Restart Service",children:e.jsx(_,{className:"w-4 h-4"})})]})})(),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{le(s),b(!0)},children:e.jsx(me,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"min-[1000px]:hidden space-y-3",children:k.map(s=>{const a=oe(s),S=`${s.network}-`,i=pe?.startsWith(S);return e.jsxs("div",{className:"p-4 rounded-lg border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg mb-1 text-gray-900 dark:text-white",children:s.name}),e.jsx(h,{color:"blue",size:"sm",className:"mt-1",children:s.network})]}),e.jsx(h,{color:a.is_active?"success":"gray",size:"sm",children:a.is_active?"Running":a.is_enabled?"Stopped":"Disabled"})]}),e.jsxs("div",{className:"space-y-2 text-sm mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Authoritative:"}),e.jsx(h,{color:s.authoritative?"success":"gray",size:"sm",children:s.authoritative?"Yes":"No"})]}),s.forward_to&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Forward To:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-mono text-xs",children:s.forward_to})]}),s.delegate_to&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Delegate To:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-mono text-xs",children:s.delegate_to})]})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>Fe(s),className:"flex-1 min-w-[80px]",children:"Records"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>ne(s),className:"flex-1 min-w-[80px]",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{le(s),b(!0)},className:"flex-1 min-w-[80px]",children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"success",onClick:()=>x(s.network,"start"),disabled:i||a.is_active,title:"Start Service",className:"flex-1 min-w-[70px]",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>x(s.network,"stop"),disabled:i||!a.is_active,title:"Stop Service",className:"flex-1 min-w-[70px]",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"warning",onClick:()=>x(s.network,"reload"),disabled:i||!a.is_active,title:"Reload Service",className:"flex-1 min-w-[70px]",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"purple",onClick:()=>x(s.network,"restart"),disabled:i,title:"Restart Service",className:"flex-1 min-w-[70px]",children:e.jsx(_,{className:"w-4 h-4"})})]})]})]},s.id)})})]})]}),e.jsxs(o,{show:Be,onClose:ie,size:"lg",children:[e.jsx(o.Header,{children:E?"Edit DNS Zone":"Create DNS Zone"}),e.jsx(o.Body,{children:e.jsxs("div",{className:"space-y-4",children:[ye&&e.jsx(g,{color:"failure",children:ye}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneName",value:"Zone Name *"}),e.jsx(v,{id:"zoneName",value:N,onChange:s=>T(s.target.value),placeholder:"example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneNetwork",value:"Network *"}),e.jsxs(xe,{id:"zoneNetwork",value:M,onChange:s=>z(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"zoneAuthoritative",checked:O,onChange:s=>B(s.target.checked),className:"w-4 h-4"}),e.jsx(c,{htmlFor:"zoneAuthoritative",value:"Authoritative (serve locally)"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneForwardTo",value:"Forward To (optional)"}),e.jsx(v,{id:"zoneForwardTo",value:L,onChange:s=>V(s.target.value),placeholder:"192.168.1.1",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"zoneDelegateTo",value:"Delegate To (optional)"}),e.jsx(v,{id:"zoneDelegateTo",value:I,onChange:s=>q(s.target.value),placeholder:"ns1.example.com",className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"zoneEnabled",checked:P,onChange:s=>$(s.target.checked),className:"w-4 h-4"}),e.jsx(c,{htmlFor:"zoneEnabled",value:"Enabled"})]})]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"blue",onClick:Ke,disabled:D||!N.trim(),children:D?"Saving...":"Save"}),e.jsx(r,{color:"gray",onClick:ie,children:"Cancel"})]})]}),e.jsxs(o,{show:Le,onClose:ce,size:"4xl",children:[e.jsx(o.Header,{children:n?`DNS Records for ${n.name}`:"DNS Records"}),e.jsx(o.Body,{children:e.jsxs("div",{className:"space-y-4",children:[R&&e.jsx(g,{color:"failure",children:R}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Records"}),n&&e.jsxs(r,{size:"sm",color:"blue",onClick:()=>Ze(n),children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Add Record"]})]}),ke.length===0?e.jsx(g,{color:"info",children:"No records in this zone. Add a record to get started."}):e.jsxs(l,{children:[e.jsxs(l.Head,{children:[e.jsx(l.HeadCell,{children:"Name"}),e.jsx(l.HeadCell,{children:"Type"}),e.jsx(l.HeadCell,{children:"Value"}),e.jsx(l.HeadCell,{children:"Comment"}),e.jsx(l.HeadCell,{children:"Status"}),e.jsx(l.HeadCell,{children:"Actions"})]}),e.jsx(l.Body,{className:"divide-y",children:ke.map(s=>e.jsxs(l.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(l.Cell,{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx(l.Cell,{children:e.jsx(h,{color:s.type==="A"?"blue":"purple",children:s.type})}),e.jsx(l.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.value}),e.jsx(l.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.comment||"-"}),e.jsx(l.Cell,{children:e.jsx(h,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(l.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"xs",color:"gray",onClick:()=>{ce(),Ze(n,s)},children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{De(s),F(!0)},children:e.jsx(me,{className:"w-4 h-4"})})]})})]},s.id))})]})]})}),e.jsx(o.Footer,{children:e.jsx(r,{color:"gray",onClick:ce,children:"Close"})})]}),e.jsxs(o,{show:Ve,onClose:de,size:"lg",children:[e.jsx(o.Header,{children:W?"Edit DNS Record":"Create DNS Record"}),e.jsx(o.Body,{children:e.jsxs("div",{className:"space-y-4",children:[R&&e.jsx(g,{color:"failure",children:R}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordName",value:"Record Name *"}),e.jsx(v,{id:"recordName",value:f,onChange:s=>G(s.target.value),placeholder:"hostname.example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordType",value:"Record Type *"}),e.jsxs(xe,{id:"recordType",value:w,onChange:s=>U(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"A",children:"A (IPv4 Address)"}),e.jsx("option",{value:"CNAME",children:"CNAME (Alias)"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordValue",value:w==="A"?"IP Address *":"Target Hostname *"}),e.jsx(v,{id:"recordValue",value:y,onChange:s=>J(s.target.value),placeholder:w==="A"?"192.168.1.1":"target.example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recordComment",value:"Comment (optional)"}),e.jsx(v,{id:"recordComment",value:Q,onChange:s=>X(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recordEnabled",checked:ee,onChange:s=>se(s.target.checked),className:"w-4 h-4"}),e.jsx(c,{htmlFor:"recordEnabled",value:"Enabled"})]})]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"blue",onClick:Ye,disabled:D||!f.trim()||!y.trim(),children:D?"Saving...":"Save"}),e.jsx(r,{color:"gray",onClick:de,children:"Cancel"})]})]}),e.jsxs(o,{show:Ie,onClose:()=>b(!1),size:"md",children:[e.jsx(o.Header,{children:"Delete Zone"}),e.jsx(o.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete zone ",e.jsx("strong",{children:ae?.name}),"? This will also delete all records in this zone."]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"failure",onClick:We,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>b(!1),children:"Cancel"})]})]}),e.jsxs(o,{show:qe,onClose:()=>F(!1),size:"md",children:[e.jsx(o.Header,{children:"Delete Record"}),e.jsx(o.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete record ",e.jsx("strong",{children:te?.name}),"?"]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"failure",onClick:Ge,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>F(!1),children:"Cancel"})]})]})]})})]})]})}export{cs as Dns};
