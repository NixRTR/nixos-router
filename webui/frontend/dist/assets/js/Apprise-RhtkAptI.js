import{j as e,C as $,L as o,S as ee,B as k,T as l,h as C,i as xe,A as j,k as Z,l as ue,m as pe,n as ge,a as je}from"./ui-vendor-Ch5Bctwu.js";import{r as c,u as fe}from"./react-vendor-DKKOAuGG.js";import{u as ve,S as Y,N as _}from"./useMetrics-UnE1bGvb.js";import{a as b}from"./index-B6L9Vk3L.js";import"./http-vendor-B9ygI19o.js";function ye(){const[f,w]=c.useState(""),[a,u]=c.useState({}),[x,F]=c.useState(""),[A,v]=c.useState(!1),H=[{value:"email",label:"Email (SMTP)"},{value:"homeassistant",label:"Home Assistant"},{value:"discord",label:"Discord"},{value:"slack",label:"Slack"},{value:"telegram",label:"Telegram"},{value:"ntfy",label:"ntfy"}],y=s=>encodeURIComponent(s),E=()=>{if(!f)return;let s="";switch(f){case"email":{const d=String(a.username||""),h=String(a.password||""),p=String(a.smtpHost||""),S=String(a.port||"587"),M=String(a.to||""),N=String(a.from||d);s=`${S==="465"?"mailtos":"mailto"}://${y(d)}:${y(h)}@${p}:${S}?to=${y(M)}&from=${y(N)}`;break}case"homeassistant":{const d=String(a.host||""),h=String(a.port||(a.useHttps?"443":"8123")),p=String(a.token||"");s=`${!!a.useHttps?"hassios":"hassio"}://${d}:${h}/${p}`;break}case"discord":{const d=String(a.webhookId||""),h=String(a.webhookToken||"");s=`discord://${d}/${h}`;break}case"slack":{const d=String(a.tokenA||""),h=String(a.tokenB||""),p=String(a.tokenC||"");s=`slack://${d}/${h}/${p}`;break}case"telegram":{const d=String(a.botToken||""),h=String(a.chatId||"");s=`tgram://${d}/${h}`;break}case"ntfy":{const d=String(a.topic||""),h=String(a.server||"ntfy.sh");if(a.username&&a.password){const p=String(a.username),S=String(a.password);s=`ntfy://${y(p)}:${y(S)}@${h}/${d}`}else s=`ntfy://${h}/${d}`;break}}F(s),v(!1)},B=async()=>{x&&(await navigator.clipboard.writeText(x),v(!0),setTimeout(()=>v(!1),2e3))},i=(s,d)=>{u(h=>({...h,[s]:d}))},g=()=>{w(""),u({}),F(""),v(!1)},R=()=>{if(!f)return null;switch(f){case"email":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"smtpHost",children:"SMTP Host"}),e.jsx(l,{id:"smtpHost",type:"text",placeholder:"smtp.gmail.com",value:String(a.smtpHost||""),onChange:s=>i("smtpHost",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"port",children:"Port"}),e.jsx(l,{id:"port",type:"text",placeholder:"587",value:String(a.port||"587"),onChange:s=>i("port",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use 465 for SSL/TLS, 587 for STARTTLS"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"username",children:"Username"}),e.jsx(l,{id:"username",type:"text",placeholder:"user@example.com",value:String(a.username||""),onChange:s=>i("username",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"password",children:"Password"}),e.jsx(l,{id:"password",type:"password",placeholder:"Your password",value:String(a.password||""),onChange:s=>i("password",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"to",children:"To (Recipient Email)"}),e.jsx(l,{id:"to",type:"email",placeholder:"recipient@example.com",value:String(a.to||""),onChange:s=>i("to",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"from",children:"From (Sender Email - Optional)"}),e.jsx(l,{id:"from",type:"email",placeholder:"sender@example.com",value:String(a.from||""),onChange:s=>i("from",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Defaults to username if not provided"})]})]});case"homeassistant":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"host",children:"Home Assistant Host"}),e.jsx(l,{id:"host",type:"text",placeholder:"homeassistant.local",value:String(a.host||""),onChange:s=>i("host",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"port",children:"Port"}),e.jsx(l,{id:"port",type:"text",placeholder:"8123",value:String(a.port||""),onChange:s=>i("port",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Default: 8123 (HTTP) or 443 (HTTPS)"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"token",children:"Long-lived Access Token"}),e.jsx(l,{id:"token",type:"password",placeholder:"Enter access credential",value:String(a.token||""),onChange:s=>i("token",s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"useHttps",checked:!!a.useHttps,onChange:s=>i("useHttps",s.target.checked),className:"rounded"}),e.jsx(o,{htmlFor:"useHttps",children:"Use HTTPS"})]})]});case"discord":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"webhookId",children:"Webhook ID"}),e.jsx(l,{id:"webhookId",type:"text",placeholder:"123456789012345678",value:String(a.webhookId||""),onChange:s=>i("webhookId",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"webhookToken",children:"Webhook Token"}),e.jsx(l,{id:"webhookToken",type:"password",placeholder:"Enter webhook credential",value:String(a.webhookToken||""),onChange:s=>i("webhookToken",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get these from Discord: Server Settings → Integrations → Webhooks"})]})]});case"slack":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tokenA",children:"Token A"}),e.jsx(l,{id:"tokenA",type:"password",placeholder:"Enter first credential",value:String(a.tokenA||""),onChange:s=>i("tokenA",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tokenB",children:"Token B"}),e.jsx(l,{id:"tokenB",type:"password",placeholder:"Enter second credential",value:String(a.tokenB||""),onChange:s=>i("tokenB",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tokenC",children:"Token C"}),e.jsx(l,{id:"tokenC",type:"password",placeholder:"Enter third credential",value:String(a.tokenC||""),onChange:s=>i("tokenC",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get credentials from Slack: Apps → Your App → OAuth & Permissions"})]})]});case"telegram":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"botToken",children:"Bot Token"}),e.jsx(l,{id:"botToken",type:"password",placeholder:"Enter bot credential from @BotFather",value:String(a.botToken||""),onChange:s=>i("botToken",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Get from @BotFather on Telegram"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"chatId",children:"Chat ID"}),e.jsx(l,{id:"chatId",type:"text",placeholder:"123456789",value:String(a.chatId||""),onChange:s=>i("chatId",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Your Telegram user ID or group ID"})]})]});case"ntfy":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"server",children:"Server"}),e.jsx(l,{id:"server",type:"text",placeholder:"ntfy.sh",value:String(a.server||"ntfy.sh"),onChange:s=>i("server",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Default: ntfy.sh (public server)"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"topic",children:"Topic"}),e.jsx(l,{id:"topic",type:"text",placeholder:"my-topic",value:String(a.topic||""),onChange:s=>i("topic",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Topic name (no spaces, use hyphens)"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"username",children:"Username (Optional)"}),e.jsx(l,{id:"username",type:"text",placeholder:"username",value:String(a.username||""),onChange:s=>i("username",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"password",children:"Password (Optional)"}),e.jsx(l,{id:"password",type:"password",placeholder:"password",value:String(a.password||""),onChange:s=>i("password",s.target.value)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Only required for private topics"})]})]});default:return null}};return e.jsxs($,{className:"bg-gray-50 dark:bg-gray-800",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Apprise URL Generator"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"serviceType",children:"Service Type"}),e.jsxs(ee,{id:"serviceType",value:f,onChange:s=>{w(s.target.value),u({}),F("")},children:[e.jsx("option",{value:"",children:"Select a service..."}),H.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),f&&e.jsxs(e.Fragment,{children:[R(),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(k,{onClick:E,color:"blue",children:"Generate URL"}),e.jsx(k,{onClick:g,color:"gray",outline:!0,children:"Reset"})]})]}),x&&e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{children:"Generated URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{type:"text",value:x,readOnly:!0,className:"font-mono text-sm"}),e.jsx(k,{onClick:B,color:A?"success":"gray",size:"sm",children:A?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Copy"]})})]}),e.jsx(j,{color:"info",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Note:"})," This URL contains sensitive information. Store it securely in your secrets.yaml file."]})})]})]})]})}function Te(){const f=localStorage.getItem("access_token"),w=localStorage.getItem("username")||"Unknown",a=fe(),[u,x]=c.useState(!1),[F,A]=c.useState(!1),[v,H]=c.useState([]),[y,E]=c.useState(!0),[B,i]=c.useState(null),[g,R]=c.useState(""),[s,d]=c.useState(""),[h,p]=c.useState("info"),[S,M]=c.useState(!1),[N,T]=c.useState(null),[se,X]=c.useState(new Set),[te,G]=c.useState(new Map),[ae,I]=c.useState(new Map),[re,J]=c.useState(new Set),[ne,W]=c.useState(new Map),[oe,U]=c.useState(new Map),{connectionStatus:z}=ve(f);c.useEffect(()=>{ie()},[]);const ie=async()=>{E(!0),i(null);try{const[r,t]=await Promise.all([b.getAppriseStatus(),b.getAppriseConfig()]);if(A(r.enabled),t.enabled&&t.services)H(t.services.map(n=>typeof n=="string"?{url:n,description:he(n)}:n));else{const n=await b.getAppriseServices();H(n)}}catch(r){i(r.response?.data?.detail||r.message||"Failed to fetch Apprise status"),A(!1)}finally{E(!1)}},le=async()=>{if(!g.trim()){T({success:!1,message:"Message body is required"});return}M(!0),T(null);try{const r=await b.sendAppriseNotification(g,s||void 0,h||void 0);T(r),r.success&&(R(""),d(""),p("info"))}catch(r){T({success:!1,message:r.response?.data?.detail||r.message||"Failed to send notification"})}finally{M(!1)}},ce=async r=>{if(!g.trim()){U(t=>new Map(t).set(r,"Message body is required"));return}J(t=>new Set(t).add(r)),U(t=>{const n=new Map(t);return n.delete(r),n}),W(t=>{const n=new Map(t);return n.delete(r),n});try{const t=await b.sendAppriseNotificationToService(r,g,s||void 0,h||void 0);if(W(n=>new Map(n).set(r,t)),!t.success){const n=t.details?`${t.message}: ${t.details}`:t.message;U(m=>new Map(m).set(r,n))}}catch(t){const n=t.response?.data?.detail||t.message||"Failed to send notification";U(m=>new Map(m).set(r,n)),W(m=>new Map(m).set(r,{success:!1,message:n}))}finally{J(t=>{const n=new Set(t);return n.delete(r),n})}},de=async r=>{X(t=>new Set(t).add(r)),I(t=>{const n=new Map(t);return n.delete(r),n}),G(t=>{const n=new Map(t);return n.delete(r),n});try{const t=await b.testAppriseService(r);if(G(n=>new Map(n).set(r,t)),!t.success){const n=t.details?`${t.message}: ${t.details}`:t.message;I(m=>new Map(m).set(r,n))}}catch(t){const n=t.response?.data?.detail||t.message||"Failed to send test notification";I(m=>new Map(m).set(r,n)),G(m=>new Map(m).set(r,{success:!1,message:n}))}finally{X(t=>{const n=new Set(t);return n.delete(r),n})}},K=()=>{const r=window.location.origin,t=localStorage.getItem("access_token");return`curl -X POST ${r}/api/apprise/notify \\
  -H "Authorization: Bearer ${t}" \\
  -H "Content-Type: application/json" \\
  -d '{
    "body": "Your notification message here",
    "title": "Notification Title (optional)",
    "notification_type": "info"
  }'`},he=r=>{const t=r.match(/^([^:]+):/);return t?t[1].charAt(0).toUpperCase()+t[1].slice(1):"Unknown Service"},q=async()=>{await b.logout(),a("/login")};return y?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Y,{onLogout:q,isOpen:u,onClose:()=>x(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(_,{hostname:"nixos-router",username:w,connectionStatus:z,onMenuClick:()=>x(!u)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"text-center py-16 text-gray-500",children:"Loading Apprise configuration..."})})]})]}):F?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Y,{onLogout:q,isOpen:u,onClose:()=>x(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(_,{hostname:"nixos-router",username:w,connectionStatus:z,onMenuClick:()=>x(!u)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ue,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Apprise Notifications"})]}),B&&e.jsx(j,{color:"failure",className:"mb-6",children:B}),N&&e.jsx(j,{color:N.success?"success":"failure",icon:N.success?C:pe,className:"mb-6",onDismiss:()=>T(null),children:N.message}),e.jsxs($,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"How It Works"}),e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:["Apprise is integrated into the NixOS Router WebUI backend, allowing you to send notifications to multiple services configured in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}),e.jsx("p",{children:"Notifications can be sent to all configured services simultaneously, or you can test individual services to verify they're working correctly."}),e.jsx("p",{children:e.jsx("strong",{children:"Notification Types:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"info"})," - General information (default)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"success"})," - Success messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"warning"})," - Warning messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"failure"})," - Error/failure messages"]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(ye,{})}),e.jsxs($,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Send Notification"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",value:"Title (optional)"}),e.jsx(l,{id:"title",type:"text",placeholder:"Notification title",value:s,onChange:r=>d(r.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"body",value:"Message Body *"}),e.jsx(ge,{id:"body",placeholder:"Enter your notification message...",value:g,onChange:r=>R(r.target.value),rows:4,className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"type",value:"Notification Type"}),e.jsxs(ee,{id:"type",value:h,onChange:r=>p(r.target.value),className:"mt-1",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"failure",children:"Failure"})]})]}),e.jsx(k,{onClick:le,disabled:S||!g.trim(),className:"w-full sm:w-auto",children:S?"Sending...":"Send to All Services"})]})]}),e.jsxs($,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Configured Services (",v.length,")"]}),v.length===0?e.jsxs(j,{color:"info",icon:Z,children:["No notification services are configured. Add services in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}):e.jsx("div",{className:"space-y-4",children:v.map((r,t)=>{const n=se.has(t),m=te.get(t),Q=ae.get(t),L=m?.success===!0,O=re.has(t),P=ne.get(t),V=oe.get(t),D=P?.success===!0;return e.jsxs($,{className:"bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(je,{color:"info",children:r.description}),L&&e.jsx(C,{className:"w-5 h-5 text-green-500",title:"Test successful"}),D&&e.jsx(C,{className:"w-5 h-5 text-blue-500",title:"Notification sent"})]}),e.jsx("code",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:r.url}),Q&&e.jsx(j,{color:"failure",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Test Error:"})," ",Q]})}),m?.success&&m.details&&e.jsx(j,{color:"success",className:"mt-2",children:e.jsx("div",{className:"text-sm",children:m.details})}),V&&e.jsx(j,{color:"failure",className:"mt-2",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Send Error:"})," ",V]})}),P?.success&&P.details&&e.jsx(j,{color:"success",className:"mt-2",children:e.jsx("div",{className:"text-sm",children:P.details})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(k,{size:"sm",color:L?"success":"light",onClick:()=>de(t),disabled:n||O,children:n?"Testing...":L?"Test Again":"Test"}),L&&!n&&e.jsx(C,{className:"absolute -top-1 -right-1 w-5 h-5 text-green-500 bg-white dark:bg-gray-800 rounded-full"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{size:"sm",color:D?"success":"blue",onClick:()=>ce(t),disabled:O||n||!g.trim(),children:O?"Sending...":D?"Send Again":"Send"}),D&&!O&&e.jsx(C,{className:"absolute -top-1 -right-1 w-5 h-5 text-blue-500 bg-white dark:bg-gray-800 rounded-full"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(o,{value:"Example cURL Command",className:"mb-2 block"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto pr-20",children:e.jsx("code",{children:K()})}),e.jsx(k,{size:"xs",color:"light",className:"absolute top-2 right-2",onClick:async()=>{try{await navigator.clipboard.writeText(K())}catch(me){console.error("Failed to copy:",me)}},children:"Copy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Replace the message body, title, and notification_type as needed."})]})]},t)})})]})]})})]})]}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Y,{onLogout:q,isOpen:u,onClose:()=>x(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(_,{hostname:"nixos-router",username:w,connectionStatus:z,onMenuClick:()=>x(!u)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs(j,{color:"warning",icon:Z,children:[e.jsx("span",{className:"font-medium",children:"Apprise is not enabled."}),e.jsxs("div",{className:"mt-2 text-sm",children:["To enable Apprise notifications, set ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"apprise.enable = true"})," in your ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"})," file."]})]})})]})]})}export{Te as Apprise};
