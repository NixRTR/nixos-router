import{j as e,t as ze,B as l,A as f,L as o,S as fe,C as Ue,n as Ce,b as t,a as te,d as pe,o as ye,M as r,q as be,T as d,s as Ve}from"./ui-vendor-DScGsZT8.js";import{u as Ge,r as a}from"./react-vendor-DKKOAuGG.js";import{u as Je,S as Ke,N as Qe}from"./useMetrics-CUBvl5M7.js";import{a as m}from"./index-C-5DTgAM.js";import"./http-vendor-B9ygI19o.js";function es(){const H=localStorage.getItem("access_token"),Se=localStorage.getItem("username")||"Unknown",ae=Ge(),[re,le]=a.useState(!1),[R,De]=a.useState([]),[He,ne]=a.useState(!0),[oe,x]=a.useState(null),[C,Re]=a.useState("all"),[Ee,ie]=a.useState(!1),[u,E]=a.useState(null),[de,F]=a.useState("homelab"),[A,M]=a.useState(!0),[j,_]=a.useState(""),[v,P]=a.useState(""),[I,L]=a.useState("1h"),[O,T]=a.useState(""),[q,B]=a.useState(""),[p,c]=a.useState(!1),[ce,w]=a.useState(null),[Fe,me]=a.useState(!1),[Ae,he]=a.useState(!1),[i,xe]=a.useState(null),[z,ue]=a.useState([]),[y,U]=a.useState(null),[g,V]=a.useState(""),[k,G]=a.useState(""),[N,J]=a.useState(""),[K,Q]=a.useState(""),[W,X]=a.useState(!0),[je,h]=a.useState(null),[Me,b]=a.useState(!1),[_e,S]=a.useState(!1),[Y,ve]=a.useState(null),[Z,we]=a.useState(null),{connectionStatus:Pe}=Je(H);a.useEffect(()=>{if(!H){ae("/login");return}$()},[H,C]);const $=async()=>{ne(!0),x(null);try{const s=C==="all"?void 0:C,n=await m.getDhcpNetworks(s);De(n)}catch(s){x(s?.response?.data?.detail||s.message||"Failed to load DHCP networks")}finally{ne(!1)}},D=async s=>{try{const n=await m.getDhcpReservations(s);ue(n)}catch(n){x(n?.response?.data?.detail||n.message||"Failed to load DHCP reservations")}},Ie=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),ae("/login")},ge=s=>{s?(E(s),F(s.network),M(s.enabled),_(s.start),P(s.end),L(s.lease_time),T(s.dns_servers?.join(", ")||""),B(s.dynamic_domain||"")):(E(null),F("homelab"),M(!0),_(""),P(""),L("1h"),T(""),B("")),w(null),ie(!0)},ee=()=>{ie(!1),E(null),w(null)},Le=async()=>{w(null),c(!0);try{if(!j.trim()||!v.trim()){w("Start and end IP addresses are required"),c(!1);return}const s=O.trim()?O.split(",").map(n=>n.trim()).filter(n=>n):null;if(u){const n={enabled:A,start:j.trim(),end:v.trim(),lease_time:I.trim(),dns_servers:s,dynamic_domain:q.trim()||null};await m.updateDhcpNetwork(u.id,n)}else{const n={network:de,enabled:A,start:j.trim(),end:v.trim(),lease_time:I.trim(),dns_servers:s,dynamic_domain:q.trim()||null};await m.createDhcpNetwork(n)}await $(),ee()}catch(s){w(s?.response?.data?.detail||s.message||"Failed to save network")}finally{c(!1)}},Oe=async()=>{if(Y)try{await m.deleteDhcpNetwork(Y.id),await $(),b(!1),ve(null)}catch(s){x(s?.response?.data?.detail||s.message||"Failed to delete network")}},Te=async s=>{xe(s),await D(s.id),me(!0)},ke=()=>{me(!1),xe(null),ue([])},Ne=s=>{s?(U(s),V(s.hostname),G(s.hw_address),J(s.ip_address),Q(s.comment||""),X(s.enabled)):(U(null),V(""),G(""),J(""),Q(""),X(!0)),h(null),he(!0)},se=()=>{he(!1),U(null),h(null),i&&D(i.id)},qe=async()=>{if(i){h(null),c(!0);try{if(!g.trim()){h("Hostname is required"),c(!1);return}if(!k.trim()){h("MAC address is required"),c(!1);return}if(!N.trim()){h("IP address is required"),c(!1);return}if(y){const s={hostname:g.trim(),hw_address:k.trim(),ip_address:N.trim(),comment:K.trim()||null,enabled:W};await m.updateDhcpReservation(y.id,s)}else{const s={network_id:i.id,hostname:g.trim(),hw_address:k.trim(),ip_address:N.trim(),comment:K.trim()||null,enabled:W};await m.createDhcpReservation(i.id,s)}await D(i.id),se()}catch(s){h(s?.response?.data?.detail||s.message||"Failed to save reservation")}finally{c(!1)}}},Be=async()=>{if(Z)try{await m.deleteDhcpReservation(Z.id),i&&await D(i.id),S(!1),we(null)}catch(s){x(s?.response?.data?.detail||s.message||"Failed to delete reservation")}};return He?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading DHCP networks..."})]})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Ke,{onLogout:Ie,isOpen:re,onClose:()=>le(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Qe,{hostname:"nixos-router",username:Se,connectionStatus:Pe,onMenuClick:()=>le(!re)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DHCP Management"})]}),e.jsx(l,{color:"blue",onClick:()=>ge(),children:"New Network"})]}),oe&&e.jsx(f,{color:"failure",className:"mb-6",onDismiss:()=>x(null),children:oe}),e.jsxs("div",{className:"mb-4",children:[e.jsx(o,{htmlFor:"networkFilter",value:"Filter by Network"}),e.jsxs(fe,{id:"networkFilter",value:C,onChange:s=>Re(s.target.value),className:"mt-1 w-48",children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs(Ue,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["DHCP Networks (",R.length,")"]}),R.length===0?e.jsx(f,{color:"info",icon:Ce,children:"No DHCP networks configured. Create a network to get started."}):e.jsxs(t,{children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Network"}),e.jsx(t.HeadCell,{children:"IP Range"}),e.jsx(t.HeadCell,{children:"Lease Time"}),e.jsx(t.HeadCell,{children:"DNS Servers"}),e.jsx(t.HeadCell,{children:"Dynamic Domain"}),e.jsx(t.HeadCell,{children:"Status"}),e.jsx(t.HeadCell,{children:"Actions"})]}),e.jsx(t.Body,{className:"divide-y",children:R.map(s=>e.jsxs(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(t.Cell,{children:e.jsx(te,{color:"blue",children:s.network})}),e.jsxs(t.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:[s.start," - ",s.end]}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.lease_time}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.dns_servers?.join(", ")||"-"}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.dynamic_domain||"-"}),e.jsx(t.Cell,{children:e.jsx(te,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(t.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"xs",color:"blue",onClick:()=>Te(s),children:"Reservations"}),e.jsx(l,{size:"xs",color:"gray",onClick:()=>ge(s),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(l,{size:"xs",color:"failure",onClick:()=>{ve(s),b(!0)},children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsxs(r,{show:Ee,onClose:ee,size:"lg",children:[e.jsx(r.Header,{children:u?"Edit DHCP Network":"Create DHCP Network"}),e.jsx(r.Body,{children:e.jsxs("div",{className:"space-y-4",children:[ce&&e.jsx(f,{color:"failure",children:ce}),!u&&e.jsxs("div",{children:[e.jsx(o,{htmlFor:"networkNetwork",value:"Network *"}),e.jsxs(fe,{id:"networkNetwork",value:de,onChange:s=>F(s.target.value),className:"mt-1",required:!0,children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{id:"networkEnabled",checked:A,onChange:s=>M(s.target.checked)}),e.jsx(o,{htmlFor:"networkEnabled",value:"Enabled"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"networkStart",value:"IP Range Start *"}),e.jsx(d,{id:"networkStart",value:j,onChange:s=>_(s.target.value),placeholder:"192.168.2.100",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"networkEnd",value:"IP Range End *"}),e.jsx(d,{id:"networkEnd",value:v,onChange:s=>P(s.target.value),placeholder:"192.168.2.200",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"networkLeaseTime",value:"Lease Time *"}),e.jsx(d,{id:"networkLeaseTime",value:I,onChange:s=>L(s.target.value),placeholder:"1h, 1d, or 86400",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"networkDnsServers",value:"DNS Servers (comma-separated)"}),e.jsx(d,{id:"networkDnsServers",value:O,onChange:s=>T(s.target.value),placeholder:"192.168.2.1, 8.8.8.8",className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"networkDynamicDomain",value:"Dynamic DNS Domain (optional)"}),e.jsx(d,{id:"networkDynamicDomain",value:q,onChange:s=>B(s.target.value),placeholder:"dhcp.homelab.local",className:"mt-1"})]})]})}),e.jsxs(r.Footer,{children:[e.jsx(l,{color:"blue",onClick:Le,disabled:p||!j.trim()||!v.trim(),children:p?"Saving...":u?"Update":"Create"}),e.jsx(l,{color:"gray",onClick:ee,children:"Cancel"})]})]}),e.jsxs(r,{show:Fe,onClose:ke,size:"6xl",children:[e.jsxs(r.Header,{children:["Reservations - ",i?.network.toUpperCase()]}),e.jsxs(r.Body,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Static IP Reservations (",z.length,")"]}),e.jsxs(l,{size:"sm",color:"blue",onClick:()=>Ne(),children:[e.jsx(Ve,{className:"w-4 h-4 mr-1"}),"New Reservation"]})]}),z.length===0?e.jsx(f,{color:"info",icon:Ce,children:"No reservations configured for this network."}):e.jsxs(t,{children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Hostname"}),e.jsx(t.HeadCell,{children:"MAC Address"}),e.jsx(t.HeadCell,{children:"IP Address"}),e.jsx(t.HeadCell,{children:"Comment"}),e.jsx(t.HeadCell,{children:"Status"}),e.jsx(t.HeadCell,{children:"Actions"})]}),e.jsx(t.Body,{className:"divide-y",children:z.map(s=>e.jsxs(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(t.Cell,{className:"font-medium text-gray-900 dark:text-white",children:s.hostname}),e.jsx(t.Cell,{className:"font-mono text-sm text-gray-500 dark:text-gray-400",children:s.hw_address}),e.jsx(t.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.ip_address}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.comment||"-"}),e.jsx(t.Cell,{children:e.jsx(te,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(t.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"xs",color:"gray",onClick:()=>Ne(s),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(l,{size:"xs",color:"failure",onClick:()=>{we(s),S(!0)},children:e.jsx(ye,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsx(r.Footer,{children:e.jsx(l,{color:"gray",onClick:ke,children:"Close"})})]}),e.jsxs(r,{show:Ae,onClose:se,size:"lg",children:[e.jsx(r.Header,{children:y?"Edit Reservation":"Create Reservation"}),e.jsx(r.Body,{children:e.jsxs("div",{className:"space-y-4",children:[je&&e.jsx(f,{color:"failure",children:je}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reservationHostname",value:"Hostname *"}),e.jsx(d,{id:"reservationHostname",value:g,onChange:s=>V(s.target.value),placeholder:"desktop",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reservationHwAddress",value:"MAC Address *"}),e.jsx(d,{id:"reservationHwAddress",value:k,onChange:s=>G(s.target.value),placeholder:"11:22:33:44:55:66",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reservationIpAddress",value:"IP Address *"}),e.jsx(d,{id:"reservationIpAddress",value:N,onChange:s=>J(s.target.value),placeholder:"192.168.2.50",required:!0,className:"mt-1 font-mono"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"reservationComment",value:"Comment (optional)"}),e.jsx(d,{id:"reservationComment",value:K,onChange:s=>Q(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{id:"reservationEnabled",checked:W,onChange:s=>X(s.target.checked)}),e.jsx(o,{htmlFor:"reservationEnabled",value:"Enabled"})]})]})}),e.jsxs(r.Footer,{children:[e.jsx(l,{color:"blue",onClick:qe,disabled:p||!g.trim()||!k.trim()||!N.trim(),children:p?"Saving...":y?"Update":"Create"}),e.jsx(l,{color:"gray",onClick:se,children:"Cancel"})]})]}),e.jsxs(r,{show:Me,onClose:()=>b(!1),size:"md",children:[e.jsx(r.Header,{children:"Delete DHCP Network"}),e.jsx(r.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete the DHCP network for ",e.jsx("strong",{children:Y?.network}),"? This will also delete all reservations for this network."]})}),e.jsxs(r.Footer,{children:[e.jsx(l,{color:"failure",onClick:Oe,children:"Delete"}),e.jsx(l,{color:"gray",onClick:()=>b(!1),children:"Cancel"})]})]}),e.jsxs(r,{show:_e,onClose:()=>S(!1),size:"md",children:[e.jsx(r.Header,{children:"Delete Reservation"}),e.jsx(r.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete the reservation for ",e.jsx("strong",{children:Z?.hostname}),"?"]})}),e.jsxs(r.Footer,{children:[e.jsx(l,{color:"failure",onClick:Be,children:"Delete"}),e.jsx(l,{color:"gray",onClick:()=>S(!1),children:"Cancel"})]})]})]})})]})]})}export{es as Dhcp};
