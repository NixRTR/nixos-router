import{j as e,r as Ue,B as r,A as m,L as i,S as ne,C as We,n as Ye,b as t,a as w,d as be,s as Je,t as Qe,u as ke,o as De,M as o,T as j,v as Xe}from"./ui-vendor-CT-4tH1q.js";import{u as es,r as l}from"./react-vendor-DKKOAuGG.js";import{u as ss,S as ts,N as as}from"./useMetrics-D4xLp6nI.js";import{a as c}from"./index-qz0IyGl2.js";import"./http-vendor-B9ygI19o.js";function cs(){const F=localStorage.getItem("access_token"),Re=localStorage.getItem("username")||"Unknown",ie=es(),[ce,de]=l.useState(!1),[Z,Fe]=l.useState([]),[Ze,he]=l.useState(!0),[ue,d]=l.useState(null),[y,Ae]=l.useState("all"),[Ee,He]=l.useState({}),[Te,xe]=l.useState(null),[ze,me]=l.useState(!1),[A,E]=l.useState(null),[g,H]=l.useState(""),[T,z]=l.useState("homelab"),[M,_]=l.useState(!0),[O,B]=l.useState(""),[L,V]=l.useState(""),[I,q]=l.useState(!0),[S,h]=l.useState(!1),[je,v]=l.useState(null),[Me,ge]=l.useState(!1),[_e,ve]=l.useState(!1),[n,P]=l.useState(null),[Ne,fe]=l.useState([]),[$,K]=l.useState(null),[N,G]=l.useState(""),[f,U]=l.useState("A"),[p,W]=l.useState(""),[Y,J]=l.useState(""),[Q,X]=l.useState(!0),[C,x]=l.useState(null),[Oe,b]=l.useState(!1),[Be,k]=l.useState(!1),[ee,pe]=l.useState(null),[se,we]=l.useState(null),{connectionStatus:Le}=ss(F);l.useEffect(()=>{if(!F){ie("/login");return}te()},[F,y]);const te=async()=>{he(!0),d(null);try{const s=y==="all"?void 0:y,a=await c.getDnsZones(s);Fe(a)}catch(s){d(s?.response?.data?.detail||s.message||"Failed to load DNS zones")}finally{he(!1)}},Ve=async()=>{try{const[s,a]=await Promise.all([c.getDnsServiceStatus("homelab"),c.getDnsServiceStatus("lan")]);He({homelab:s,lan:a})}catch(s){console.error("Failed to fetch DNS service statuses:",s)}},D=async(s,a)=>{const oe=`${s}-${a}`;xe(oe);try{await c.controlDnsService(s,a),setTimeout(()=>{Ve()},1e3)}catch(u){d(u?.response?.data?.detail||u.message||`Failed to ${a} DNS service`)}finally{xe(null)}},ye=s=>{const a=Ee[s.network];return!a||!a.exists?{is_active:!1,is_enabled:!1}:{is_active:a.is_active,is_enabled:a.is_enabled}},R=async s=>{try{const a=await c.getDnsRecords(s);fe(a)}catch(a){d(a?.response?.data?.detail||a.message||"Failed to load DNS records")}},Ie=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),ie("/login")},Se=s=>{s?(E(s),H(s.name),z(s.network),_(s.authoritative),B(s.forward_to||""),V(s.delegate_to||""),q(s.enabled)):(E(null),H(""),z("homelab"),_(!0),B(""),V(""),q(!0)),v(null),me(!0)},ae=()=>{me(!1),E(null),v(null)},qe=async()=>{v(null),h(!0);try{if(!g.trim()){v("Zone name is required"),h(!1);return}if(A){const s={name:g.trim(),network:T,authoritative:M,forward_to:O.trim()||null,delegate_to:L.trim()||null,enabled:I};await c.updateDnsZone(A.id,s)}else{const s={name:g.trim(),network:T,authoritative:M,forward_to:O.trim()||null,delegate_to:L.trim()||null,enabled:I};await c.createDnsZone(s)}await te(),ae()}catch(s){v(s?.response?.data?.detail||s.message||"Failed to save zone")}finally{h(!1)}},Pe=async()=>{if(ee)try{await c.deleteDnsZone(ee.id),await te(),b(!1),pe(null)}catch(s){d(s?.response?.data?.detail||s.message||"Failed to delete zone")}},$e=async s=>{P(s),await R(s.id),ge(!0)},Ce=(s,a)=>{P(s),a?(K(a),G(a.name),U(a.type),W(a.value),J(a.comment||""),X(a.enabled)):(K(null),G(""),U("A"),W(""),J(""),X(!0)),x(null),ve(!0)},le=()=>{ge(!1),P(null),fe([])},re=()=>{ve(!1),K(null),x(null),n&&R(n.id)},Ke=async()=>{if(n){x(null),h(!0);try{if(!N.trim()){x("Record name is required"),h(!1);return}if(!p.trim()){x("Record value is required"),h(!1);return}if($){const s={name:N.trim(),type:f,value:p.trim(),comment:Y.trim()||null,enabled:Q};await c.updateDnsRecord($.id,s)}else{const s={zone_id:n.id,name:N.trim(),type:f,value:p.trim(),comment:Y.trim()||null,enabled:Q};await c.createDnsRecord(n.id,s)}await R(n.id),re()}catch(s){x(s?.response?.data?.detail||s.message||"Failed to save record")}finally{h(!1)}}},Ge=async()=>{if(se)try{await c.deleteDnsRecord(se.id),n&&await R(n.id),k(!1),we(null)}catch(s){d(s?.response?.data?.detail||s.message||"Failed to delete record")}};return Ze?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading DNS zones..."})]})}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(ts,{onLogout:Ie,isOpen:ce,onClose:()=>de(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(as,{hostname:"nixos-router",username:Re,connectionStatus:Le,onMenuClick:()=>de(!ce)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"DNS Management"})]}),e.jsx(r,{color:"blue",onClick:()=>Se(),children:"New Zone"})]}),ue&&e.jsx(m,{color:"failure",className:"mb-6",onDismiss:()=>d(null),children:ue}),e.jsxs("div",{className:"mb-4",children:[e.jsx(i,{htmlFor:"networkFilter",value:"Filter by Network"}),e.jsxs(ne,{id:"networkFilter",value:y,onChange:s=>Ae(s.target.value),className:"mt-1 w-48",children:[e.jsx("option",{value:"all",children:"All Networks"}),e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs(We,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["DNS Zones (",Z.length,")"]}),Z.length===0?e.jsx(m,{color:"info",icon:Ye,children:"No DNS zones configured. Create a zone to get started."}):e.jsxs(t,{children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Name"}),e.jsx(t.HeadCell,{children:"Network"}),e.jsx(t.HeadCell,{children:"Authoritative"}),e.jsx(t.HeadCell,{children:"Forward To"}),e.jsx(t.HeadCell,{children:"Delegate To"}),e.jsx(t.HeadCell,{children:"Status"}),e.jsx(t.HeadCell,{children:"Actions"})]}),e.jsx(t.Body,{className:"divide-y",children:Z.map(s=>e.jsxs(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(t.Cell,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx(t.Cell,{children:e.jsx(w,{color:"blue",children:s.network})}),e.jsx(t.Cell,{children:e.jsx(w,{color:s.authoritative?"success":"gray",children:s.authoritative?"Yes":"No"})}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.forward_to||"-"}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.delegate_to||"-"}),e.jsx(t.Cell,{children:(()=>{const a=ye(s);return e.jsx(w,{color:a.is_active?"success":"gray",children:a.is_active?"Running":a.is_enabled?"Stopped":"Disabled"})})()}),e.jsx(t.Cell,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(r,{size:"xs",color:"blue",onClick:()=>$e(s),children:"Records"}),e.jsx(r,{size:"xs",color:"gray",onClick:()=>Se(s),children:e.jsx(be,{className:"w-4 h-4"})}),(()=>{const a=ye(s),oe=`${s.network}-`,u=Te?.startsWith(oe);return e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"xs",color:"success",onClick:()=>D(s.network,"start"),disabled:u||a.is_active,title:"Start Service",children:e.jsx(Je,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>D(s.network,"stop"),disabled:u||!a.is_active,title:"Stop Service",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"warning",onClick:()=>D(s.network,"reload"),disabled:u||!a.is_active,title:"Reload Service",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"purple",onClick:()=>D(s.network,"restart"),disabled:u,title:"Restart Service",children:e.jsx(ke,{className:"w-4 h-4"})})]})})(),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{pe(s),b(!0)},children:e.jsx(De,{className:"w-4 h-4"})})]})})]},s.id))})]})]}),e.jsxs(o,{show:ze,onClose:ae,size:"lg",children:[e.jsx(o.Header,{children:A?"Edit DNS Zone":"Create DNS Zone"}),e.jsx(o.Body,{children:e.jsxs("div",{className:"space-y-4",children:[je&&e.jsx(m,{color:"failure",children:je}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"zoneName",value:"Zone Name *"}),e.jsx(j,{id:"zoneName",value:g,onChange:s=>H(s.target.value),placeholder:"example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"zoneNetwork",value:"Network *"}),e.jsxs(ne,{id:"zoneNetwork",value:T,onChange:s=>z(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"homelab",children:"HOMELAB"}),e.jsx("option",{value:"lan",children:"LAN"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"zoneAuthoritative",checked:M,onChange:s=>_(s.target.checked),className:"w-4 h-4"}),e.jsx(i,{htmlFor:"zoneAuthoritative",value:"Authoritative (serve locally)"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"zoneForwardTo",value:"Forward To (optional)"}),e.jsx(j,{id:"zoneForwardTo",value:O,onChange:s=>B(s.target.value),placeholder:"192.168.1.1",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"zoneDelegateTo",value:"Delegate To (optional)"}),e.jsx(j,{id:"zoneDelegateTo",value:L,onChange:s=>V(s.target.value),placeholder:"ns1.example.com",className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"zoneEnabled",checked:I,onChange:s=>q(s.target.checked),className:"w-4 h-4"}),e.jsx(i,{htmlFor:"zoneEnabled",value:"Enabled"})]})]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"blue",onClick:qe,disabled:S||!g.trim(),children:S?"Saving...":"Save"}),e.jsx(r,{color:"gray",onClick:ae,children:"Cancel"})]})]}),e.jsxs(o,{show:Me,onClose:le,size:"4xl",children:[e.jsx(o.Header,{children:n?`DNS Records for ${n.name}`:"DNS Records"}),e.jsx(o.Body,{children:e.jsxs("div",{className:"space-y-4",children:[C&&e.jsx(m,{color:"failure",children:C}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Records"}),n&&e.jsxs(r,{size:"sm",color:"blue",onClick:()=>Ce(n),children:[e.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Add Record"]})]}),Ne.length===0?e.jsx(m,{color:"info",children:"No records in this zone. Add a record to get started."}):e.jsxs(t,{children:[e.jsxs(t.Head,{children:[e.jsx(t.HeadCell,{children:"Name"}),e.jsx(t.HeadCell,{children:"Type"}),e.jsx(t.HeadCell,{children:"Value"}),e.jsx(t.HeadCell,{children:"Comment"}),e.jsx(t.HeadCell,{children:"Status"}),e.jsx(t.HeadCell,{children:"Actions"})]}),e.jsx(t.Body,{className:"divide-y",children:Ne.map(s=>e.jsxs(t.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e.jsx(t.Cell,{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx(t.Cell,{children:e.jsx(w,{color:s.type==="A"?"blue":"purple",children:s.type})}),e.jsx(t.Cell,{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.value}),e.jsx(t.Cell,{className:"text-gray-500 dark:text-gray-400",children:s.comment||"-"}),e.jsx(t.Cell,{children:e.jsx(w,{color:s.enabled?"success":"gray",children:s.enabled?"Enabled":"Disabled"})}),e.jsx(t.Cell,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"xs",color:"gray",onClick:()=>{le(),Ce(n,s)},children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx(r,{size:"xs",color:"failure",onClick:()=>{we(s),k(!0)},children:e.jsx(De,{className:"w-4 h-4"})})]})})]},s.id))})]})]})}),e.jsx(o.Footer,{children:e.jsx(r,{color:"gray",onClick:le,children:"Close"})})]}),e.jsxs(o,{show:_e,onClose:re,size:"lg",children:[e.jsx(o.Header,{children:$?"Edit DNS Record":"Create DNS Record"}),e.jsx(o.Body,{children:e.jsxs("div",{className:"space-y-4",children:[C&&e.jsx(m,{color:"failure",children:C}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"recordName",value:"Record Name *"}),e.jsx(j,{id:"recordName",value:N,onChange:s=>G(s.target.value),placeholder:"hostname.example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"recordType",value:"Record Type *"}),e.jsxs(ne,{id:"recordType",value:f,onChange:s=>U(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"A",children:"A (IPv4 Address)"}),e.jsx("option",{value:"CNAME",children:"CNAME (Alias)"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"recordValue",value:f==="A"?"IP Address *":"Target Hostname *"}),e.jsx(j,{id:"recordValue",value:p,onChange:s=>W(s.target.value),placeholder:f==="A"?"192.168.1.1":"target.example.com",required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"recordComment",value:"Comment (optional)"}),e.jsx(j,{id:"recordComment",value:Y,onChange:s=>J(s.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recordEnabled",checked:Q,onChange:s=>X(s.target.checked),className:"w-4 h-4"}),e.jsx(i,{htmlFor:"recordEnabled",value:"Enabled"})]})]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"blue",onClick:Ke,disabled:S||!N.trim()||!p.trim(),children:S?"Saving...":"Save"}),e.jsx(r,{color:"gray",onClick:re,children:"Cancel"})]})]}),e.jsxs(o,{show:Oe,onClose:()=>b(!1),size:"md",children:[e.jsx(o.Header,{children:"Delete Zone"}),e.jsx(o.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete zone ",e.jsx("strong",{children:ee?.name}),"? This will also delete all records in this zone."]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"failure",onClick:Pe,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>b(!1),children:"Cancel"})]})]}),e.jsxs(o,{show:Be,onClose:()=>k(!1),size:"md",children:[e.jsx(o.Header,{children:"Delete Record"}),e.jsx(o.Body,{children:e.jsxs("p",{className:"text-gray-700 dark:text-gray-300",children:["Are you sure you want to delete record ",e.jsx("strong",{children:se?.name}),"?"]})}),e.jsxs(o.Footer,{children:[e.jsx(r,{color:"failure",onClick:Ge,children:"Delete"}),e.jsx(r,{color:"gray",onClick:()=>k(!1),children:"Cancel"})]})]})]})})]})]})}export{cs as Dns};
