import{j as e,A as x,h as M,i as X,k as D,l as G,C as u,L as g,T as Y,m as J,S as K,B as y,a as Q}from"./ui-vendor-CgIz45wR.js";import{u as V,r as a}from"./react-vendor-DKKOAuGG.js";import{u as Z,S as j,N}from"./useMetrics-IzacKmZd.js";import{a as l}from"./index-m6wlWkcF.js";import"./http-vendor-B9ygI19o.js";function ne(){const U=localStorage.getItem("access_token"),m=localStorage.getItem("username")||"Unknown",W=V(),[n,r]=a.useState(!1),[_,v]=a.useState(!1),[f,b]=a.useState([]),[z,S]=a.useState(!0),[k,w]=a.useState(null),[c,C]=a.useState(""),[T,A]=a.useState(""),[L,I]=a.useState("info"),[B,E]=a.useState(!1),[d,i]=a.useState(null),[F,O]=a.useState(null),{connectionStatus:h}=Z(U);a.useEffect(()=>{$()},[]);const $=async()=>{S(!0),w(null);try{const[s,t]=await Promise.all([l.getAppriseStatus(),l.getAppriseConfig()]);if(v(s.enabled),t.enabled&&t.services)b(t.services.map(o=>({url:o})));else{const o=await l.getAppriseServices();b(o)}}catch(s){w(s.response?.data?.detail||s.message||"Failed to fetch Apprise status"),v(!1)}finally{S(!1)}},q=async()=>{if(!c.trim()){i({success:!1,message:"Message body is required"});return}E(!0),i(null);try{const s=await l.sendAppriseNotification(c,T||void 0,L||void 0);i(s),s.success&&(C(""),A(""),I("info"))}catch(s){i({success:!1,message:s.response?.data?.detail||s.message||"Failed to send notification"})}finally{E(!1)}},P=async s=>{O(s),i(null);try{const t=await l.sendAppriseNotification(`This is a test notification from the NixOS Router WebUI. Testing service: ${R(s)}`,"Test Notification","info");i(t)}catch(t){i({success:!1,message:t.response?.data?.detail||t.message||"Failed to send test notification"})}finally{O(null)}},H=()=>{const s=window.location.origin,t=localStorage.getItem("access_token");return`curl -X POST ${s}/api/apprise/notify \\
  -H "Authorization: Bearer ${t}" \\
  -H "Content-Type: application/json" \\
  -d '{
    "body": "Your notification message here",
    "title": "Notification Title (optional)",
    "notification_type": "info"
  }'`},R=s=>{const t=s.match(/^([^:]+):/);return t?t[1].charAt(0).toUpperCase()+t[1].slice(1):"Unknown Service"},p=async()=>{await l.logout(),W("/login")};return z?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(j,{onLogout:p,isOpen:n,onClose:()=>r(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(N,{hostname:"nixos-router",username:m,connectionStatus:h,onMenuClick:()=>r(!n)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsx("div",{className:"text-center py-16 text-gray-500",children:"Loading Apprise configuration..."})})]})]}):_?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(j,{onLogout:p,isOpen:n,onClose:()=>r(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(N,{hostname:"nixos-router",username:m,connectionStatus:h,onMenuClick:()=>r(!n)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(X,{className:"w-8 h-8 text-gray-900 dark:text-white"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Apprise Notifications"})]}),k&&e.jsx(x,{color:"failure",className:"mb-6",children:k}),d&&e.jsx(x,{color:d.success?"success":"failure",icon:d.success?D:G,className:"mb-6",onDismiss:()=>i(null),children:d.message}),e.jsxs(u,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"How It Works"}),e.jsxs("div",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:["Apprise is integrated into the NixOS Router WebUI backend, allowing you to send notifications to multiple services configured in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}),e.jsx("p",{children:"Notifications can be sent to all configured services simultaneously, or you can test individual services to verify they're working correctly."}),e.jsx("p",{children:e.jsx("strong",{children:"Notification Types:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"info"})," - General information (default)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"success"})," - Success messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"warning"})," - Warning messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"failure"})," - Error/failure messages"]})]})]})]}),e.jsxs(u,{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Send Notification"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"title",value:"Title (optional)"}),e.jsx(Y,{id:"title",type:"text",placeholder:"Notification title",value:T,onChange:s=>A(s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"body",value:"Message Body *"}),e.jsx(J,{id:"body",placeholder:"Enter your notification message...",value:c,onChange:s=>C(s.target.value),rows:4,className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"type",value:"Notification Type"}),e.jsxs(K,{id:"type",value:L,onChange:s=>I(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"failure",children:"Failure"})]})]}),e.jsx(y,{onClick:q,disabled:B||!c.trim(),className:"w-full sm:w-auto",children:B?"Sending...":"Send to All Services"})]})]}),e.jsxs(u,{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Configured Services (",f.length,")"]}),f.length===0?e.jsxs(x,{color:"info",icon:M,children:["No notification services are configured. Add services in ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"}),"."]}):e.jsx("div",{className:"space-y-4",children:f.map((s,t)=>e.jsxs(u,{className:"bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(Q,{color:"info",children:R(s.url)})}),e.jsx("code",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:s.url})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(y,{size:"sm",color:"light",onClick:()=>P(s.url),disabled:F===s.url,children:F===s.url?"Testing...":"Test"})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(g,{value:"Example cURL Command",className:"mb-2 block"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto pr-20",children:e.jsx("code",{children:H()})}),e.jsx(y,{size:"xs",color:"light",className:"absolute top-2 right-2",onClick:async()=>{try{await navigator.clipboard.writeText(H())}catch(o){console.error("Failed to copy:",o)}},children:"Copy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Replace the message body, title, and notification_type as needed."})]})]},t))})]})]})})]})]}):e.jsxs("div",{className:"flex h-screen",children:[e.jsx(j,{onLogout:p,isOpen:n,onClose:()=>r(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(N,{hostname:"nixos-router",username:m,connectionStatus:h,onMenuClick:()=>r(!n)}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900",children:e.jsxs(x,{color:"warning",icon:M,children:[e.jsx("span",{className:"font-medium",children:"Apprise is not enabled."}),e.jsxs("div",{className:"mt-2 text-sm",children:["To enable Apprise notifications, set ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"apprise.enable = true"})," in your ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"router-config.nix"})," file."]})]})})]})]})}export{ne as Apprise};
